---
phase: 06-notification-domain-refactoring
plan: 01
type: execute
---

<objective>
Clean up notification domain by removing duplicate interfaces and clarifying service responsibilities.

Purpose: Reduce confusion from duplicate interfaces and conflicting service names, establish clear patterns for notification handling.
Output: Consolidated notification interfaces, deprecated duplicates, cleaner separation between database notifications and external facade notifications.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-location-domain-refactoring/05-02-SUMMARY.md

**Key files:**
@handlers/notification_handler.go
@models/notification/service/notification_service.go
@models/notification/service/interfaces.go
@store/notification_store.go
@internal/store/interfaces.go (NotificationStore section)
@services/notification_service.go
@services/push_service.go
@internal/notification/client.go

**Tech stack available:** Go, Gin, SQLC, PostgreSQL, Expo Push, AWS notification facade
**Established patterns:**
- Deprecation comments with TODO for Phase 12
- getUserIDFromContext helper
- store.ErrNotFound/ErrForbidden error handling

**Issues being addressed:**
1. Duplicate NotificationStore interfaces (store/ vs internal/store/)
2. Duplicate NotificationService interface (interfaces.go has NotificationServiceInterface, notification_service.go has NotificationService)
3. Confusing naming: services/notification_service.go is AWS facade client, models/notification/service/ is database service
</context>

<tasks>

<task type="auto">
  <name>Task 1: Consolidate NotificationService interface in models/notification/service/</name>
  <files>models/notification/service/interfaces.go, models/notification/service/notification_service.go</files>
  <action>
Remove duplicate interface definition. The file interfaces.go defines NotificationServiceInterface while notification_service.go defines NotificationService interface. They have nearly identical methods.

1. Delete interfaces.go entirely - notification_service.go already has the canonical interface
2. Verify notification_service.go's NotificationService interface includes DeleteAllNotifications (which interfaces.go was missing)
3. The interface in notification_service.go is the authoritative one - it's co-located with the implementation

Do NOT change any method signatures or implementations.
  </action>
  <verify>go build ./models/notification/... compiles successfully</verify>
  <done>interfaces.go deleted, NotificationService interface remains sole interface in notification_service.go</done>
</task>

<task type="auto">
  <name>Task 2: Deprecate duplicate NotificationStore in internal/store/interfaces.go</name>
  <files>internal/store/interfaces.go</files>
  <action>
Add deprecation comment to NotificationStore interface in internal/store/interfaces.go (similar to LocationStore deprecation from Phase 5).

The canonical interface is store.NotificationStore in store/notification_store.go which uses:
- uuid.UUID for IDs
- models.Notification type

The internal/store version uses:
- string IDs
- types.NotificationCreate and types.Notification
- Different method signatures

Add deprecation comment:
```go
// Deprecated: NotificationStore in internal/store/interfaces.go is deprecated.
// Use store.NotificationStore from store/notification_store.go instead, which uses
// uuid.UUID for type safety and models.Notification for the domain model.
// This interface exists for the unused Store.Notification() method pattern.
// TODO(phase-12): Remove this interface after consolidating store patterns.
```

Do NOT delete the interface - just mark as deprecated for Phase 12 cleanup.
  </action>
  <verify>go build ./internal/store/... compiles successfully</verify>
  <done>NotificationStore in internal/store/interfaces.go has deprecation comment with TODO for Phase 12</done>
</task>

<task type="auto">
  <name>Task 3: Rename services/notification_service.go to clarify it's the AWS facade client</name>
  <files>services/notification_service.go, services/notification_service_test.go</files>
  <action>
The name collision is confusing:
- services/notification_service.go is an AWS facade API client for external notifications
- models/notification/service/notification_service.go is the database-backed notification service

Rename to clarify purpose:
1. Rename services/notification_service.go → services/notification_facade_service.go
2. Rename services/notification_service_test.go → services/notification_facade_service_test.go
3. Rename the struct NotificationService → NotificationFacadeService
4. Rename constructor NewNotificationService → NewNotificationFacadeService
5. Update any references in the same file (method receivers stay 's')

Search for imports of services.NotificationService and update if needed. Check main.go for usage.
  </action>
  <verify>
go build ./services/... compiles successfully
grep -r "services.NotificationService" . shows no remaining references (should now be NotificationFacadeService)
  </verify>
  <done>AWS facade service renamed to NotificationFacadeService, no name collision with database notification service</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build ./...` compiles successfully (or document pre-existing issues)
- [ ] `go build ./models/notification/...` passes
- [ ] `go build ./services/...` passes
- [ ] No duplicate NotificationService interface definitions
- [ ] NotificationStore in internal/store has deprecation comment
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- interfaces.go deleted from models/notification/service/
- internal/store/interfaces.go NotificationStore deprecated
- services/notification_service.go renamed to notification_facade_service.go
- Clear separation: NotificationService (database) vs NotificationFacadeService (AWS facade)
</success_criteria>

<output>
After completion, create `.planning/phases/06-notification-domain-refactoring/06-01-SUMMARY.md`
</output>
