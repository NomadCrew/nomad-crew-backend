---
phase: 27-test-suite-repair
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - config/config_test.go
  - config/database_utils_test.go
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "config package compiles without errors"
    - "Tests use current DatabaseConfig struct fields"
  artifacts:
    - path: "config/config_test.go"
      provides: "Config test suite using individual DB fields"
    - path: "config/database_utils_test.go"
      provides: "Database utils tests using individual DB fields"
  key_links:
    - from: "config/*_test.go"
      to: "config/config.go"
      via: "DatabaseConfig struct"
      pattern: "DatabaseConfig\\{"
---

<objective>
Fix config package test compilation failures by removing ConnectionString field references.

Purpose: The DatabaseConfig struct was refactored to use individual fields (Host, Port, User, Password, Name) instead of a single ConnectionString field. Tests still reference the removed field.
Output: Compilable config tests that use the current struct definition.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@config/config.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix config_test.go ConnectionString references</name>
  <files>config/config_test.go</files>
  <action>
CONFIRMED: DatabaseConfig has NO ConnectionString field and NO GetConnectionString() method.
The current DatabaseConfig struct (config.go lines 42-54) only has: Host, Port, User, Password, Name, MaxConnections, SSLMode, MaxOpenConns, MaxIdleConns, ConnMaxLife.

REQUIRED CHANGES:

1. DELETE the entire TestGetConnectionString function (lines 46-98)
   - This function tests GetConnectionString() method that doesn't exist
   - The functionality was removed during refactoring
   - Delete from "func TestGetConnectionString(t *testing.T) {" to the closing "}"

2. Line 209: DELETE this assertion in "Load with custom values" test
   DELETE: `assert.Equal(t, "postgresql://user:pass@host:5432/db", cfg.Database.ConnectionString)`
   ALSO DELETE: env setup line 183: `os.Setenv("DATABASE_URL", "postgresql://user:pass@host:5432/db")`

3. Lines 334, 378, 396: Remove ConnectionString from validateConfig test cases
   - Line 334: Change `ConnectionString: "postgresql://user:pass@host:5432/db",` to use individual fields:
     ```go
     Host: "host",
     User: "user",
     Password: "pass",
     Name: "db",
     ```
   - Line 378: Same - replace ConnectionString with Host/User/Password/Name
   - Line 396: Same - replace ConnectionString with Host/User/Password/Name

The current DatabaseConfig requires Host, User, Name to be non-empty per validateConfig().
  </action>
  <verify>go test -c ./config/... compiles without errors related to ConnectionString</verify>
  <done>config_test.go compiles without unknown field ConnectionString errors</done>
</task>

<task type="auto">
  <name>Task 2: Fix database_utils_test.go ConnectionString references</name>
  <files>config/database_utils_test.go</files>
  <action>
Update test cases in database_utils_test.go:

1. Line 26: "Valid connection string" test case
   - Remove ConnectionString field from DatabaseConfig literal
   - The test is for ConfigureNeonPostgresPool which builds connection from individual fields
   - Update to use: Host, Port, User, Password, Name, SSLMode

2. Line 82: Another test case with ConnectionString
   - Remove field, use individual fields instead
   - Check the test purpose and update accordingly

For the "Valid connection string" test at line 26:
```go
config: &DatabaseConfig{
    Host:         "neon.tech",
    Port:         5432,
    User:         "user",
    Password:     "pass",
    Name:         "db",
    SSLMode:      "require",
},
```

Check ConfigureNeonPostgresPool function signature to ensure tests align with actual API.
  </action>
  <verify>go test -c ./config/... compiles without errors</verify>
  <done>database_utils_test.go compiles without unknown field errors</done>
</task>

</tasks>

<verification>
```bash
# Verify config package compiles
go test -c ./config/...

# Run config tests
go test -v ./config/...
```
</verification>

<success_criteria>
- config package compiles: `go test -c ./config/...` exits 0
- No "unknown field ConnectionString" errors
- No "undefined: GetConnectionString" errors
- TestGetConnectionString function removed (tests non-existent functionality)
</success_criteria>

<output>
After completion, create `.planning/phases/27-test-suite-repair/27-05-SUMMARY.md`
</output>
