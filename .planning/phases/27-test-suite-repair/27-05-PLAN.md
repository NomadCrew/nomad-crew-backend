---
phase: 27-test-suite-repair
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - config/config_test.go
  - config/database_utils_test.go
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "config package compiles without errors"
    - "Tests use current DatabaseConfig struct fields"
  artifacts:
    - path: "config/config_test.go"
      provides: "Config test suite using individual DB fields"
    - path: "config/database_utils_test.go"
      provides: "Database utils tests using individual DB fields"
  key_links:
    - from: "config/*_test.go"
      to: "config/config.go"
      via: "DatabaseConfig struct"
      pattern: "DatabaseConfig\\{"
---

<objective>
Fix config package test compilation failures by removing ConnectionString field references.

Purpose: The DatabaseConfig struct was refactored to use individual fields (Host, Port, User, Password, Name) instead of a single ConnectionString field. Tests still reference the removed field.
Output: Compilable config tests that use the current struct definition.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@config/config.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix config_test.go ConnectionString references</name>
  <files>config/config_test.go</files>
  <action>
Remove all references to DatabaseConfig.ConnectionString field:

1. Line 55-63: Update "Use connection string when provided" test case
   - Remove ConnectionString field from struct literal
   - Test should verify GetConnectionString() builds from individual fields

2. Line 68: Remove ConnectionString field from "Build from individual parameters" test
   - This test already has correct individual fields, just remove ConnectionString: ""

3. Line 94: Update assertion
   - tt.config.GetConnectionString() needs to be valid - check if DatabaseConfig has this method
   - If GetConnectionString() doesn't exist, either add it or use a different test approach

4. Line 209: In "Load with custom values" test
   - Remove assertion: cfg.Database.ConnectionString
   - The DATABASE_URL env var may map to individual fields or not exist anymore

5. Lines 334, 378, 396: In validateConfig test cases
   - Remove ConnectionString field from struct literals
   - Use individual fields (Host, Port, User, Password, Name) instead

Check if DatabaseConfig.GetConnectionString() method exists in config.go. If not:
- Either the tests should be removed (if functionality no longer exists)
- Or build connection string manually in tests using fmt.Sprintf

The current DatabaseConfig struct has: Host, Port, User, Password, Name, SSLMode, MaxOpenConns, MaxIdleConns, ConnMaxLife
  </action>
  <verify>go test -c ./config/... compiles without errors related to ConnectionString</verify>
  <done>config_test.go compiles without unknown field ConnectionString errors</done>
</task>

<task type="auto">
  <name>Task 2: Fix database_utils_test.go ConnectionString references</name>
  <files>config/database_utils_test.go</files>
  <action>
Update test cases in database_utils_test.go:

1. Line 26: "Valid connection string" test case
   - Remove ConnectionString field from DatabaseConfig literal
   - The test is for ConfigureNeonPostgresPool which builds connection from individual fields
   - Update to use: Host, Port, User, Password, Name, SSLMode

2. Line 82: Another test case with ConnectionString
   - Remove field, use individual fields instead
   - Check the test purpose and update accordingly

For the "Valid connection string" test at line 26:
```go
config: &DatabaseConfig{
    Host:         "neon.tech",
    Port:         5432,
    User:         "user",
    Password:     "pass",
    Name:         "db",
    SSLMode:      "require",
},
```

Check ConfigureNeonPostgresPool function signature to ensure tests align with actual API.
  </action>
  <verify>go test -c ./config/... compiles without errors</verify>
  <done>database_utils_test.go compiles without unknown field errors</done>
</task>

</tasks>

<verification>
```bash
# Verify config package compiles
go test -c ./config/...

# Run config tests
go test -v ./config/...
```
</verification>

<success_criteria>
- config package compiles: `go test -c ./config/...` exits 0
- No "unknown field ConnectionString" errors
- Tests pass or skip gracefully if GetConnectionString() method doesn't exist
</success_criteria>

<output>
After completion, create `.planning/phases/27-test-suite-repair/27-05-SUMMARY.md`
</output>
