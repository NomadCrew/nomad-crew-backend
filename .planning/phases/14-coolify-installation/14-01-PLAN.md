---
phase: 14-coolify-installation
plan: 01
type: execute
domain: infra
---

<objective>
Install and configure Coolify on AWS EC2 ARM instance for Heroku-like deployment experience.

Purpose: Establish self-hosted PaaS for deploying NomadCrew backend with git-push deployments.
Output: Running Coolify instance accessible via web interface, ready for application deployment.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Auto-selected based on dependency graph:
@.planning/phases/13-oracle-cloud-setup/13-01-SUMMARY.md

# Key infrastructure files:
@infrastructure/aws/main.tf
@infrastructure/aws/outputs.tf

**Tech stack available:** terraform, aws-provider
**Established patterns:** infrastructure-as-code, arm-graviton

**Constraining decisions:**
- [Phase 13]: AWS EC2 t4g.small deployed at 3.130.209.141
- [Phase 13]: ARM Graviton architecture selected (~$14/month)
- [Phase 13]: Ports 22, 80, 443 already open in security group

**Instance details:**
- IP: 3.130.209.141
- SSH: `ssh ubuntu@3.130.209.141`
- OS: Ubuntu 22.04 ARM64
- RAM: ~1.8 GB (2 GB instance)
- Storage: 28 GB available

**Discovery findings (Level 2):**
- Coolify supports ARM64 natively
- Minimum requirements: 2 CPU, 2 GB RAM, 30 GB storage (we meet all)
- Installation via single curl command
- Coolify handles Docker installation automatically
- Access via port 8000 initially, then Traefik handles 80/443
- Admin account must be created immediately after installation
</context>

<tasks>

<task type="auto">
  <name>Task 1: Prepare server and install Coolify</name>
  <files>N/A (remote server commands only)</files>
  <action>
SSH to 3.130.209.141 and run the following steps:

1. Update system packages:
   ```
   sudo apt update && sudo apt upgrade -y
   ```

2. Install Coolify using official installer (handles Docker automatically):
   ```
   curl -fsSL https://cdn.coollabs.io/coolify/install.sh | sudo bash
   ```

The Coolify installer will:
- Install Docker and Docker Compose if not present
- Create /data/coolify directory structure
- Generate SSH keys for server management
- Download configuration files
- Create Docker network "coolify"
- Start Coolify containers

**IMPORTANT:** Wait for installation to complete fully (may take 2-5 minutes on ARM).
**DO NOT** install Docker separately - let Coolify's script handle it to ensure compatibility.
  </action>
  <verify>
SSH commands to verify:
```
docker ps | grep coolify
curl -s http://localhost:8000 | head -20
```
Should show coolify containers running and HTML response from dashboard.
  </verify>
  <done>Coolify containers running, localhost:8000 responding</done>
</task>

<task type="auto">
  <name>Task 2: Configure AWS security group for Coolify port</name>
  <files>infrastructure/aws/main.tf</files>
  <action>
Add port 8000 to the AWS security group ingress rules for initial Coolify dashboard access.

In the security group resource, add a new ingress rule:
```hcl
ingress {
  description = "Coolify Dashboard"
  from_port   = 8000
  to_port     = 8000
  protocol    = "tcp"
  cidr_blocks = ["0.0.0.0/0"]
}
```

Then apply the Terraform changes:
```
cd infrastructure/aws && terraform apply -auto-approve
```

**Note:** Port 8000 is only needed for initial setup. After domain configuration in Phase 17, Traefik will handle routing through ports 80/443.
  </action>
  <verify>
```
cd infrastructure/aws && terraform show | grep 8000
curl -s --connect-timeout 5 http://3.130.209.141:8000 | head -20
```
Should show port 8000 in security group and HTML response from public IP.
  </verify>
  <done>Port 8000 open, Coolify dashboard accessible from internet</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Coolify PaaS installed on AWS EC2 ARM instance</what-built>
  <how-to-verify>
    1. Open browser to: http://3.130.209.141:8000
    2. You should see the Coolify registration page
    3. Create your admin account immediately (first user becomes admin)
    4. After registration, you should see the Coolify dashboard
    5. Verify in dashboard: Settings > Server shows "localhost" as connected
  </how-to-verify>
  <resume-signal>Type "approved" with your Coolify admin email, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `docker ps | grep coolify` shows running containers on server
- [ ] Port 8000 accessible from internet
- [ ] Coolify dashboard loads in browser
- [ ] Admin account created successfully
- [ ] Server shows as connected in Coolify dashboard
</verification>

<success_criteria>

- Coolify installed and running on ARM64 server
- Dashboard accessible at http://3.130.209.141:8000
- Admin account created
- Server validated and connected in Coolify
- Ready for Phase 15 (CI/CD Pipeline Migration)
</success_criteria>

<output>
After completion, create `.planning/phases/14-coolify-installation/14-01-SUMMARY.md` with:

---
phase: 14-coolify-installation
plan: 01
subsystem: infra
tags: [coolify, docker, paas, arm64]

# Dependency graph
requires:
  - phase: 13-oracle-cloud-setup
    provides: EC2 instance at 3.130.209.141
provides:
  - Running Coolify instance for git-push deployments
  - Docker and Docker Compose installed
  - Traefik reverse proxy configured
affects: [15-cicd-pipeline, 16-application-deployment, 17-domain-ssl-config]

# Tech tracking
tech-stack:
  added: [coolify, docker, traefik]
  patterns: [self-hosted-paas, container-orchestration]

key-files:
  created: []
  modified:
    - infrastructure/aws/main.tf

key-decisions:
  - [Document any decisions made during installation]

# Metrics
duration: [actual time]
completed: [date]
---

# Phase 14 Plan 01: Coolify Installation Summary

**[One-liner summary of what shipped]**

## Accomplishments
- [Key outcomes]

## Files Modified
- `infrastructure/aws/main.tf` - Added port 8000 to security group

## Decisions Made
- [Any decisions]

## Issues Encountered
- [Any issues]

## Next Phase Readiness
Ready for Phase 15: CI/CD Pipeline Migration
- Coolify dashboard: http://3.130.209.141:8000
- [Prerequisites for Phase 15]
</output>
